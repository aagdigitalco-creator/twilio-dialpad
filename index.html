<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Twilio Web Dialpad</title>
</head>
<body>
  <h2>Web Dialpad</h2>
  <input id="phoneNumber" placeholder="+1XXXXXXXXXX" />
  <button id="callBtn">Call</button>
  <button id="hangupBtn">Hang Up</button>

  <script src="https://media.twiliocdn.com/sdk/js/voice/latest/twilio-voice.min.js"></script>
  <script>
    console.log("✅ Page loaded");

    const callBtn = document.getElementById("callBtn");
    const hangupBtn = document.getElementById("hangupBtn");
    let device, connection;

    async function initTwilio() {
      console.log("🔑 Fetching Twilio token...");
      const res = await fetch("https://outbound-dial-3814.twil.io/token");
      const data = await res.json();

      device = new Twilio.Device(data.token, {
        debug: true,
        codecPreferences: ["opus", "pcmu"],
      });

      device.on("ready", () => console.log("✅ Device ready"));
      device.on("error", (err) => console.error("❌ Twilio Error:", err));
      device.on("disconnect", () => console.log("🛑 Call ended"));
    }

    callBtn.onclick = () => {
      const number = document.getElementById("phoneNumber").value;
      console.log("📞 Dialing:", number);
      if (!device) return console.error("Device not ready yet");
      connection = device.connect({ params: { To: number } });
    };

    hangupBtn.onclick = () => {
      if (connection) connection.disconnect();
    };

    initTwilio();
  </script>
</body>
</html>
