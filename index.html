<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Twilio Web Dialpad (v2 Fixed)</title>

    <!-- ‚úÖ Correct CDN for Twilio Voice SDK -->
    <script src="https://sdk.twilio.com/js/client/v1.13/twilio.min.js"></script>

    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        background: #f8f9fa;
      }
      #number {
        font-size: 22px;
        margin-bottom: 15px;
        height: 30px;
        min-width: 220px;
        text-align: center;
        border-bottom: 2px solid #007bff;
      }
      #dialpad {
        display: grid;
        grid-template-columns: repeat(3, 80px);
        gap: 10px;
      }
      button {
        font-size: 20px;
        padding: 15px;
        border-radius: 10px;
        border: none;
        background: #007bff;
        color: white;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      #controls {
        margin-top: 20px;
      }
      #status {
        margin-top: 10px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h2>Twilio Web Dialpad</h2>
    <div id="number" contenteditable="true" placeholder="Enter number"></div>
    <div id="dialpad">
      <button>1</button><button>2</button><button>3</button>
      <button>4</button><button>5</button><button>6</button>
      <button>7</button><button>8</button><button>9</button>
      <button>+</button><button>0</button><button>#</button>
    </div>
    <div id="controls">
      <button id="call">üìû Call</button>
      <button id="hangup">‚ùå Hangup</button>
      <div id="status"></div>
    </div>

    <script>
      let device;
      const numberDisplay = document.getElementById("number");
      const callBtn = document.getElementById("call");
      const hangupBtn = document.getElementById("hangup");
      const status = document.getElementById("status");

      // Keyboard typing for number field
      document.addEventListener("keydown", (e) => {
        if (/[\d#+]/.test(e.key)) numberDisplay.textContent += e.key;
        if (e.key === "Backspace")
          numberDisplay.textContent = numberDisplay.textContent.slice(0, -1);
      });

      document.querySelectorAll("#dialpad button").forEach((btn) => {
        btn.addEventListener("click", () => {
          numberDisplay.textContent += btn.textContent;
        });
      });

      async function initTwilio() {
        console.log("Fetching Twilio token...");
        const res = await fetch("https://outbound-dial-3814.twil.io/token");
        const data = await res.json();

        // ‚úÖ Use Twilio.Device (since v1.13 supports this)
        device = new Twilio.Device(data.token, { debug: true });

        device.on("ready", () => {
          console.log("‚úÖ Twilio Device Ready");
          status.textContent = "‚úÖ Ready to call";
        });

        device.on("error", (err) => {
          console.error("‚ùå Twilio Error:", err);
          status.textContent = "‚ùå Error: " + err.message;
        });

        device.on("connect", () => {
          console.log("üìû Connected!");
          status.textContent = "üìû Connected...";
        });

        device.on("disconnect", () => {
          console.log("‚ùå Call ended");
          status.textContent = "Call ended.";
        });
      }

      callBtn.onclick = () => {
        const to = numberDisplay.textContent.trim();
        if (!to) return alert("Enter a number to call (with country code)");
        console.log("Dialing:", to);
        status.textContent = "üì≤ Calling " + to + "...";
        device.connect({ To: to });
      };

      hangupBtn.onclick = () => {
        if (device) device.disconnectAll();
        status.textContent = "Call hung up.";
      };

      initTwilio();
    </script>
  </b
