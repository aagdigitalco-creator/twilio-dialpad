<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Twilio Web Dialpad</title>
</head>
<body>
  <h2>Web Dialpad</h2>
  <input id="phoneNumber" placeholder="+1XXXXXXXXXX" />
  <button id="callBtn">Call</button>
  <button id="hangupBtn">Hang Up</button>

  <!-- ✅ Use latest Twilio Voice SDK v2 -->
  <script src="https://media.twiliocdn.com/sdk/js/voice/releases/2.7.2/twilio-voice.min.js"></script>

  <script>
    console.log("✅ Page loaded");

    const callBtn = document.getElementById("callBtn");
    const hangupBtn = document.getElementById("hangupBtn");
    let device, activeConnection;

    async function initTwilio() {
      console.log("🔑 Fetching Twilio token...");
      const res = await fetch("https://outbound-dial-3814.twil.io/token");
      const data = await res.json();

      device = new Twilio.Voice.Client.Device(data.token, {
        codecPreferences: ["opus", "pcmu"],
        logLevel: 1,
      });

      device.on('ready', () => console.log("✅ Device ready"));
      device.on('error', (e) => console.error("❌ Twilio Error:", e));
      device.on('disconnect', () => console.log("🛑 Call ended"));
    }

    callBtn.onclick = () => {
      const number = document.getElementById("phoneNumber").value.trim();
      if (!number) return alert("Enter a phone number first!");
      if (!device) return alert("Device not ready yet!");

      console.log("📞 Dialing:", number);
      activeConnection = device.connect({ params: { To: number } });
    };

    hangupBtn.onclick = () => {
      if (activeConnection) {
        console.log("🛑 Hanging up call...");
        activeConnection.disconnect();
      }
    };

    initTwilio();
  </script>
</body>
</html>
